<!doctype html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>后台管理系统</title>
    <link rel="icon" th:href="@{/static/img/favicon.png}"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.3.2/dist/css/tabler.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabler-icons/3.34.0/tabler-icons.min.css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PLUGINS STYLES -->
    <link rel="stylesheet" th:href="@{/static/tabler/css/tabler-themes.min.css}" />
    <!-- END PLUGINS STYLES -->
    <!-- BEGIN CUSTOM FONT -->
    <style>
        @import url("https://rsms.me/inter/inter.css");
    </style>
    <!-- END CUSTOM FONT -->
    
    <!-- Custom styles for autosize in modals -->
    <style>
        /* 优化 Modal 中的 autosize textarea */
        .modal textarea[data-bs-toggle="autosize"] {
            min-height: 2.5rem;
            max-height: 60vh;
            transition: height 0.2s ease;
        }
        
        /* 确保 textarea 在 tab 切换时正确显示 */
        .tab-pane textarea[data-bs-toggle="autosize"] {
            min-height: 2.5rem;
        }
        
        /* 移动端响应式logo样式 */
        .logo-responsive {
            transition: height 0.2s ease;
        }
        
        /* 移动端调整logo高度 */
        @media (max-width: 575.98px) {
            .logo-responsive {
                height: 40px !important;
            }
        }
        
        /* 小屏幕平板调整logo高度 */
        @media (max-width: 767.98px) {
            .logo-responsive {
                height: 50px !important;
            }
        }
        
        /* 移动端数据表格优化 */
        @media (max-width: 767.98px) {
            /* 优化分页控件 */
            .pagination .page-link {
                padding: 0.375rem 0.5rem;
                font-size: 0.875rem;
            }
            
            /* 隐藏部分页码，只显示当前页和前后页 */
            .pagination .page-item:not(.active):not(:first-child):not(:last-child):not(:nth-child(2)):not(:nth-last-child(2)) {
                display: none;
            }
            
            /* 优化表格操作按钮 */
            .btn-list .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }
            
            /* 优化下拉菜单 */
            .dropdown-menu {
                min-width: 150px;
            }
            
            /* 表格文本截断优化 */
            .table-responsive .table td {
                max-width: 120px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            /* 特定表格列的移动端优化 - 隐藏不太重要的列 */
            .table-responsive .table td:nth-child(n+5):not(:last-child) {
                display: none;
            }
            
            .table-responsive .table th:nth-child(n+5):not(:last-child) {
                display: none;
            }
            
            /* 保持操作列可见 */
            .table-responsive .table td:last-child,
            .table-responsive .table th:last-child {
                display: table-cell !important;
                min-width: 80px;
            }
            
            /* 对于特定表格，可以添加更精细的控制 */
            .table-responsive .table.table-account td:nth-child(5),
            .table-responsive .table.table-account th:nth-child(5) {
                display: table-cell !important; /* 保持账户状态列可见 */
            }
            
            /* 卡片头部搜索框在移动端的优化 */
            .card-header .row .col {
                min-width: 0;
            }
            
            .card-header .form-control {
                min-width: 120px;
            }
        }
        
        /* 超小屏幕优化 */
        @media (max-width: 575.98px) {
            /* 隐藏更多分页项 */
            .pagination .page-item:not(.active):not(:first-child):not(:last-child) {
                display: none;
            }
            
            /* 分页文本简化 */
            .card-footer .text-muted {
                font-size: 0.75rem;
            }
            
            /* 页面选择器简化 */
            .form-select-sm {
                font-size: 0.75rem;
            }
            
            /* Sidebar 移动端优化 */
            .navbar-vertical.navbar-expand-lg {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            
            .navbar-vertical .navbar-nav .nav-link {
                padding: 0.5rem 1rem;
            }
            
            .navbar-vertical .navbar-nav .nav-link-icon {
                margin-right: 0.5rem;
            }
            
            /* 移动端下拉菜单项优化 */
            .navbar-vertical .dropdown-menu .dropdown-item {
                padding: 0.375rem 1rem;
                font-size: 0.875rem;
            }
            
            /* 更隐藏更多表格列 */
            .table-responsive .table td:nth-child(n+4):not(:last-child) {
                display: none;
            }
            
            .table-responsive .table th:nth-child(n+4):not(:last-child) {
                display: none;
                          }
          }
      </style>
</head>
<body>
    <!-- BEGIN GLOBAL THEME SCRIPT -->
    <script th:src="@{/static/tabler/js/tabler-theme.min.js}"></script>
    <!-- END GLOBAL THEME SCRIPT -->
    <div id="app" class="page" v-scope>
        <!--  BEGIN SIDEBAR  -->
        <th:block th:replace="~{fragments/common/sidebar :: sidebar}"></th:block>
        <!--  END SIDEBAR  -->

        <div class="page-wrapper">
            <!-- BEGIN PAGE HEADER -->
            <th:block th:replace="~{fragments/common/header :: header}"></th:block>
            <!-- END PAGE HEADER -->

            <!-- BEGIN PAGE BODY -->
            <th:block th:replace="~{'fragments' + ${uri} :: content}"></th:block>
            <!-- END PAGE BODY -->

            <!-- 页脚 -->
            <th:block th:replace="~{fragments/common/footer :: footer}"></th:block>
        </div>
    </div>

    <div class="settings">
        <a
                href="#"
                class="btn btn-floating btn-icon btn-primary"
                data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasSettings"
                aria-controls="offcanvasSettings"
                aria-label="Theme Builder"
        >
            <!-- Download SVG icon from http://tabler.io/icons/icon/brush -->
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="icon icon-1"
            >
                <path d="M3 21v-4a4 4 0 1 1 4 4h-4" />
                <path d="M21 3a16 16 0 0 0 -12.8 10.2" />
                <path d="M21 3a16 16 0 0 1 -10.2 12.8" />
                <path d="M10.6 9a9 9 0 0 1 4.4 4.4" />
            </svg>
        </a>
        <form class="offcanvas offcanvas-start offcanvas-narrow" tabindex="-1" id="offcanvasSettings">
            <div class="offcanvas-header">
                <h2 class="offcanvas-title">Theme Builder</h2>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body d-flex flex-column">
                <div>
                    <div class="mb-4">
                        <label class="form-label">Color mode</label>
                        <p class="form-hint">Choose the color mode for your app.</p>
                        <label class="form-check">
                            <div class="form-selectgroup-item">
                                <input type="radio" name="theme" value="light" class="form-check-input" checked />
                                <div class="form-check-label">Light</div>
                            </div>
                        </label>
                        <label class="form-check">
                            <div class="form-selectgroup-item">
                                <input type="radio" name="theme" value="dark" class="form-check-input" />
                                <div class="form-check-label">Dark</div>
                            </div>
                        </label>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Color scheme</label>
                        <p class="form-hint">The perfect color mode for your app.</p>
                        <div class="row g-2">
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="blue" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-blue"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="azure" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-azure"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="indigo" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-indigo"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="purple" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-purple"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="pink" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-pink"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="red" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-red"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="orange" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-orange"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="yellow" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-yellow"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="lime" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-lime"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="green" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-green"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="teal" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-teal"></span>
                                </label>
                            </div>
                            <div class="col-auto">
                                <label class="form-colorinput">
                                    <input name="theme-primary" type="radio" value="cyan" class="form-colorinput-input" />
                                    <span class="form-colorinput-color bg-cyan"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Font family</label>
                        <p class="form-hint">Choose the font family that fits your app.</p>
                        <div>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-font" value="sans-serif" class="form-check-input" checked />
                                    <div class="form-check-label">Sans-serif</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-font" value="serif" class="form-check-input" />
                                    <div class="form-check-label">Serif</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-font" value="monospace" class="form-check-input" />
                                    <div class="form-check-label">Monospace</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-font" value="comic" class="form-check-input" />
                                    <div class="form-check-label">Comic</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Theme base</label>
                        <p class="form-hint">Choose the gray shade for your app.</p>
                        <div>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-base" value="slate" class="form-check-input" />
                                    <div class="form-check-label">Slate</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-base" value="gray" class="form-check-input" checked />
                                    <div class="form-check-label">Gray</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-base" value="zinc" class="form-check-input" />
                                    <div class="form-check-label">Zinc</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-base" value="neutral" class="form-check-input" />
                                    <div class="form-check-label">Neutral</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-base" value="stone" class="form-check-input" />
                                    <div class="form-check-label">Stone</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Corner Radius</label>
                        <p class="form-hint">Choose the border radius factor for your app.</p>
                        <div>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-radius" value="0" class="form-check-input" />
                                    <div class="form-check-label">0</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-radius" value="0.5" class="form-check-input" />
                                    <div class="form-check-label">0.5</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-radius" value="1" class="form-check-input" checked />
                                    <div class="form-check-label">1</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-radius" value="1.5" class="form-check-input" />
                                    <div class="form-check-label">1.5</div>
                                </div>
                            </label>
                            <label class="form-check">
                                <div class="form-selectgroup-item">
                                    <input type="radio" name="theme-radius" value="2" class="form-check-input" />
                                    <div class="form-check-label">2</div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="mt-auto space-y">
                    <button type="button" class="btn w-100" id="reset-changes">
                        <!-- Download SVG icon from http://tabler.io/icons/icon/rotate -->
                        <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                class="icon icon-1"
                        >
                            <path d="M19.95 11a8 8 0 1 0 -.5 4m.5 5v-5h-5" />
                        </svg>
                        Reset changes
                    </button>
                    <a href="#" class="btn btn-primary w-100" data-bs-dismiss="offcanvas">
                        <!-- Download SVG icon from http://tabler.io/icons/icon/settings -->
                        <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                class="icon icon-1"
                        >
                            <path
                                    d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"
                            />
                            <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
                        </svg>
                        Save settings
                    </a>
                </div>
            </div>
        </form>
    </div>
    <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/petite-vue/0.4.1/petite-vue.umd.js"></script>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/autosize.js/6.0.1/autosize.esm.js"></script>
    <script type="module" th:src="@{/static/js/common/modal-autosize.js}"></script>
    <script type="module" th:src="@{/static/js/common/toast-utils.js}"></script>
    <!-- END GLOBAL MANDATORY SCRIPTS -->

    <!-- BEGIN PAGE SCRIPTS -->

    <script type="module" th:src="'/static/js' + ${uri} + '.js'"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // 初始化页面中的 autosize（非 Modal 中的元素）
            function initPageAutosize() {
                if (typeof autosize === 'undefined') return;
                
                const textareas = document.querySelectorAll('textarea[data-bs-toggle="autosize"]:not(.modal textarea[data-bs-toggle="autosize"])');
                if (textareas.length > 0) {
                    autosize(textareas);
                }
            }
            
            // 初始化页面中的 autosize
            initPageAutosize();
            
            // 切换logo的函数
            function updateLogo(theme) {
                const logo = document.getElementById('logo');
                if (logo) {
                    if (theme === 'dark') {
                        logo.src = '/static/img/logo-dark.png';
                    } else {
                        logo.src = '/static/img/logo.png';
                    }
                }
            }
            
            var themeConfig = {
                theme: "light",
                "theme-base": "gray",
                "theme-font": "sans-serif",
                "theme-primary": "blue",
                "theme-radius": "1",
            };
            var url = new URL(window.location);
            var form = document.getElementById("offcanvasSettings");
            var resetButton = document.getElementById("reset-changes");
            var checkItems = function () {
                for (var key in themeConfig) {
                    var value = window.localStorage["tabler-" + key] || themeConfig[key];
                    if (!!value) {
                        var radios = form.querySelectorAll(`[name="${key}"]`);
                        if (!!radios) {
                            radios.forEach((radio) => {
                                radio.checked = radio.value === value;
                            });
                        }
                    }
                }
                // 初始化时也要更新logo
                var currentTheme = window.localStorage["tabler-theme"] || themeConfig.theme;
                updateLogo(currentTheme);
            };
            form.addEventListener("change", function (event) {
                var target = event.target,
                    name = target.name,
                    value = target.value;
                for (var key in themeConfig) {
                    if (name === key) {
                        document.documentElement.setAttribute("data-bs-" + key, value);
                        window.localStorage.setItem("tabler-" + key, value);
                        url.searchParams.set(key, value);
                        
                        // 如果切换的是主题，更新logo
                        if (key === 'theme') {
                            updateLogo(value);
                        }
                    }
                }
                window.history.pushState({}, "", url);
            });
            resetButton.addEventListener("click", function () {
                for (var key in themeConfig) {
                    var value = themeConfig[key];
                    document.documentElement.removeAttribute("data-bs-" + key);
                    window.localStorage.removeItem("tabler-" + key);
                    url.searchParams.delete(key);
                }
                checkItems();
                window.history.pushState({}, "", url);
                // 重置时也要更新logo
                updateLogo(themeConfig.theme);
            });
            checkItems();
        });
    </script>
    <!-- END PAGE SCRIPTS -->

</body>
</html>